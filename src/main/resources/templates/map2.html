<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Bond Viewer - Map 2</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #eef;
          text-align: center;
          padding: 50px;
        }
        h1 {
          color: #336699;
        }
        #map2 {
          width: 1200px;
          height: 900px;
        }
    </style>

    <!--  Google Charts Loader v0 -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      fetch('/bonds/average-profit-margin')
      .then(response => response.json())
      .then(jsonData => {
        console.log('Data fetched:', jsonData);
        google.charts.load('current', {
          packages: ['geochart'],
        });
        google.charts.setOnLoadCallback(() => drawChart(jsonData));
      })
      .catch(error => console.error('Error fetching data:', error));

      function drawChart(jsonData) {
        console.log(jsonData);
        let dataArray = [];
        dataArray.push(['Country', 'Average Profit Margin']);
        jsonData.forEach(item => {
          dataArray.push([item.country, item.averageProfitMargin]);
        });

        let data = google.visualization.arrayToDataTable(dataArray);

        let options = {
          title : 'Average Bond return % by Country',
          titleTextStyle: {
            color: '#336699',
            fontSize: 20,
            bold: true
          },
          colorAxis: {colors: ['#111E0B', '#46B83D']}, // Gradient from light to dark blue
          backgroundColor: '#eef',
          datalessRegionColor: '#E2E2E2', // Light gray for regions without data
          defaultColor: '#E2E2E2', // Default color for regions without data
        };

        let chart = new google.visualization.GeoChart(document.getElementById('map2'));
        chart.draw(data, options);
      }
    </script>
</head>
<body>
  
<!-- Navbar -->
<div th:replace="~{navbar :: navbar}"></div>

<!-- Map2 -->
<div class="flex items-center justify-center h-screen">
<div id="map2" class="pt-10 "></div>
</div>

</body>
</html>